<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8">
<title>Qarz daftari</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:Arial;background:#f4f6f8;margin:0;padding:15px}
button{padding:12px;margin:5px;width:100%;font-size:16px}
input{padding:10px;width:100%;margin:6px 0}
.card{background:#fff;padding:10px;margin:8px 0;border-radius:6px}
.hidden{display:none}
.green{background:#e8ffe8}
</style>
</head>
<body>

<h2 id="title">ğŸ“’ Qarz daftari</h2>

<div id="menu">
  <button onclick="openAdd()">â• Qarz qoâ€˜shish</button>
  <button onclick="openSearch()">ğŸ” Qidirish</button>
</div>

<!-- ADD -->
<div id="addBox" class="hidden">
  <input id="date" type="date">
  <input id="name" placeholder="Ism familiya">
  <input id="phone" placeholder="Telefon raqam">
  <input id="total" type="number" placeholder="Qarz summasi">

  <input id="photo" placeholder="ğŸ“· Rasm LINK (Google Drive)">
  <small>
    ğŸ“Œ Rasm yuklash uchun Google Formdan foydalaning  
  </small>

  <button onclick="saveDebt()">ğŸ’¾ Saqlash</button>
  <button onclick="goBack()">â¬… Orqaga</button>
</div>

<!-- SEARCH -->
<div id="searchBox" class="hidden">
  <input id="query" placeholder="Ism yoki telefon orqali qidirish">
  <button onclick="doSearch()">ğŸ” Qidirish</button>
  <button onclick="loadAll()">ğŸ“‹ Barchasini koâ€˜rish</button>
  <div id="results"></div>
  <button onclick="goBack()">â¬… Orqaga</button>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbwmOW2imYGTSJ2ZW3y8P870QrXJMWfVv1Y8b8snVq4Trz5C2lcbDtzGlCfUX5RM69HFJg/exec";

function openAdd(){
  title.innerText="â• Qarz qoâ€˜shish";
  menu.classList.add("hidden");
  addBox.classList.remove("hidden");
}

function openSearch(){
  title.innerText="ğŸ” Qidirish";
  menu.classList.add("hidden");
  searchBox.classList.remove("hidden");
  loadAll();
}

function goBack(){
  title.innerText="ğŸ“’ Qarz daftari";
  menu.classList.remove("hidden");
  addBox.classList.add("hidden");
  searchBox.classList.add("hidden");
}

function saveDebt(){
  const d = date.value;
  const n = name.value.trim();
  const p = phone.value.trim();
  const t = total.value;
  const ph = photo.value.trim();

  if(!d || !n || !p || !t){
    alert("â— Majburiy maydonlar toâ€˜ldirilmagan");
    return;
  }

  fetch(API_URL,{
    method:"POST",
    body:JSON.stringify({date:d,name:n,phone:p,total:t,photo:ph})
  })
  .then(r=>r.text())
  .then(res=>{
    if(res!=="OK") throw res;
    alert("âœ… Muvaffaqiyatli saqlandi");
    goBack();
  })
  .catch(e=>alert("âŒ Xato: "+e));
}

function doSearch(){
  fetch(API_URL+"?action=search&q="+encodeURIComponent(query.value))
    .then(r=>r.json())
    .then(show)
    .catch(()=>results.innerHTML="âŒ Xatolik");
}

function loadAll(){
  fetch(API_URL)
    .then(r=>r.json())
    .then(show)
    .catch(()=>results.innerHTML="âŒ Xatolik");
}

function show(list){
  results.innerHTML="";
  if(!list.length){
    results.innerHTML="âŒ Maâ€™lumot yoâ€˜q";
    return;
  }
  list.forEach(x=>{
    results.innerHTML+=`
      <div class="card">
        ğŸ“… ${x.date}<br>
        ğŸ‘¤ ${x.name}<br>
        ğŸ“ ${x.phone}<br>
        ğŸ’° ${x.total}<br>
        ğŸ“· ${x.photo ? `<a href="${x.photo}" target="_blank">Rasmni koâ€˜rish</a>` : "Yoâ€˜q"}
      </div>
    `;
  });
}
</script>

</body>
</html>
