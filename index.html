<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8">
<title>ğŸ“’ Qarz daftari</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body { font-family: Arial; background:#f4f6f8; padding:15px; }
h2 { text-align:center; }
button { width:100%; padding:12px; margin:6px 0; font-size:16px; }
.add { background:#2ea043; color:white; border:none; }
.search { background:#0969da; color:white; border:none; }
.back { background:#6c757d; color:white; border:none; }
.all { background:#8b5cf6; color:white; border:none; }
input { width:100%; padding:10px; margin:5px 0; }
.hidden { display:none; }
.card { border:1px solid #ccc; padding:10px; margin-top:10px; background:#fff; }
.green { background:#d4edda; }
</style>
</head>

<body>

<h2 id="title">ğŸ“’ Qarz daftari</h2>

<div id="menu">
  <button class="add" onclick="openAdd()">â• Qarz qoâ€˜shish</button>
  <button class="search" onclick="openSearch()">ğŸ” Qidirish</button>
  <button class="all" onclick="loadAll()">ğŸ“‹ Barchasini koâ€˜rish</button>
</div>

<!-- ADD -->
<div id="addBox" class="hidden">
  <input id="name" placeholder="Ism familiya">
  <input id="phone" placeholder="Telefon raqam">
  <input id="total" type="number" placeholder="Qarz summasi">
  <button class="add" onclick="saveDebt()">ğŸ’¾ Saqlash</button>
  <button class="back" onclick="goBack()">ğŸ”™ Orqaga</button>
</div>

<!-- SEARCH -->
<div id="searchBox" class="hidden">
  <input id="query" placeholder="Ism yoki telefon">
  <button class="search" onclick="doSearch()">ğŸ” Qidirish</button>
  <div id="results"></div>
  <button class="back" onclick="goBack()">ğŸ”™ Orqaga</button>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbyd81D998Alfz0g9a3Umy61Ym59P8KePoZVgpAY8SpXqtJtZUR2mgSnjsdEfYa2Vj2PGw/exec";

/* UI */
function openAdd(){
  title.innerText="â• Qarz qoâ€˜shish";
  menu.classList.add("hidden");
  addBox.classList.remove("hidden");
}
function openSearch(){
  title.innerText="ğŸ” Qidirish";
  menu.classList.add("hidden");
  searchBox.classList.remove("hidden");
}
function goBack(){
  title.innerText="ğŸ“’ Qarz daftari";
  menu.classList.remove("hidden");
  addBox.classList.add("hidden");
  searchBox.classList.add("hidden");
  results.innerHTML="";
}

/* ADD */
function saveDebt(){
  fetch(API_URL,{
    method:"POST",
    body:JSON.stringify({
      action:"add",
      name:name.value,
      phone:phone.value,
      total:Number(total.value),
      date:new Date().toLocaleString()
    })
  }).then(()=>{ alert("âœ… Saqlandi"); goBack(); });
}

/* SEARCH */
function doSearch(){
  results.innerHTML="â³";
  fetch(API_URL+"?action=search&q="+query.value)
    .then(r=>r.json())
    .then(showResults);
}

/* LOAD ALL */
function loadAll(){
  title.innerText="ğŸ“‹ Barcha qarzlar";
  menu.classList.add("hidden");
  searchBox.classList.remove("hidden");
  fetch(API_URL)
    .then(r=>r.json())
    .then(showResults);
}

/* RENDER */
function showResults(list){
  results.innerHTML="";
  list.forEach(d=>{
    const r=d.total-d.paid;
    results.innerHTML+=`
      <div class="card ${r===0?'green':''}">
        <b>${d.name}</b><br>
        ğŸ“ ${d.phone}<br>
        ğŸ’° ${d.total} | ğŸ’µ ${d.paid} | ğŸ“‰ ${r}
      </div>`;
  });
}
</script>

</body>
</html>
